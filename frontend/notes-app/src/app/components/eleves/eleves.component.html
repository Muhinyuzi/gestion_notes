<div class="eleves-container">

  <!-- ğŸ”™ Bouton retour -->
  <button class="btn-back" (click)="goBack()">â† Retour</button>

  <h2>Liste des Ã©lÃ¨ves</h2>

  <div *ngIf="isLoading" class="loading">Chargement en cours...</div>
  <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

  <div class="actions-bar">
    <button class="btn btn-primary add" (click)="addEleve()">â• Ajouter un Ã©lÃ¨ve</button>
  </div>

  <table class="eleves-table" *ngIf="!isLoading && eleves?.length! > 0">
    <thead>
      <tr>
        <th>Nom</th>
        <th>PrÃ©nom</th>
        <th>Adresse</th>
        <th>Note assignÃ©e</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let eleve of eleves">
        <td>
          <a [routerLink]="['/eleves', eleve.id]" class="eleve-link">{{ eleve.nom }}</a>
        </td>
        <td>{{ eleve.prenom }}</td>
        <td>{{ eleve.adresse || '-' }}</td>

        <td>
          <span *ngIf="eleve.note_id; else assignButton">
            Note #{{ eleve.note_id }}
          </span>
          <ng-template #assignButton>
            <button class="btn btn-outline-primary btn-sm" (click)="openAssignModal(eleve)">
              ğŸ“˜ Assigner une note
            </button>
          </ng-template>
        </td>

        <td>
          <div class="actions-buttons">
            <button class="btn btn-info" (click)="editEleve(eleve)">âœï¸ Ã‰diter</button>
            <button class="btn btn-danger" (click)="deleteEleve(eleve)">ğŸ—‘ï¸ Supprimer</button>
            <button *ngIf="eleve.note_id" class="btn btn-warning" (click)="openDeassignModal(eleve)">
              âŒ DÃ©sassigner
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Modale assignation/dÃ©sassignation -->
  <div class="modal-overlay" *ngIf="showNoteModal">
    <div class="modal">
      <h3 *ngIf="modalMode==='assign'">Assigner une note Ã  {{ modalEleve?.nom }}</h3>
      <h3 *ngIf="modalMode==='deassign'">DÃ©sassigner la note de {{ modalEleve?.nom }}</h3>

      <div *ngIf="modalMode==='assign'">
        <select [(ngModel)]="selectedNoteId">
          <option value="">-- SÃ©lectionnez une note --</option>
          <option *ngFor="let note of notes" [value]="note.id">{{ note.titre }}</option>
        </select>
      </div>

      <div *ngIf="modalMode==='deassign'">
        <p>
          ÃŠtes-vous sÃ»r de vouloir dÃ©sassigner la note 
          <strong>{{ selectedNoteTitle }}</strong> de 
          <strong>{{ modalEleve?.nom }} {{ modalEleve?.prenom }}</strong> ?
        </p>
      </div>

      <div class="modal-actions">
        <button class="btn btn-primary" (click)="confirmNoteAction()">
          {{ modalMode==='assign' ? 'âœ… Assigner' : 'âŒ DÃ©sassigner' }}
        </button>
        <button class="btn btn-secondary" (click)="closeNoteModal()">Annuler</button>
      </div>
    </div>
  </div>
</div>
