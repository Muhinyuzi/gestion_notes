<app-toast #toast></app-toast>

<div *ngIf="isLoading" class="loading">â³ Chargement...</div>
<div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

<div *ngIf="note" class="note-detail">

  <!-- Mode lecture -->
  <div *ngIf="!isEditing" class="view-mode">
    <h2 class="note-title">ğŸ“ {{ note.titre }}</h2>
    <p class="note-content">{{ note.contenu }}</p>

    <!-- ğŸ–¼ï¸ Images associÃ©es Ã  la note -->
    <div class="note-images" *ngIf="note.fichiers && note.fichiers.length > 0">
      <h4>ğŸ“ Fichiers / Images :</h4>
      <div class="image-gallery">
        <img *ngFor="let fichier of note.fichiers"
             [src]="getFileUrl(fichier.chemin)"
             [alt]="fichier.nom_fichier"
             class="note-image" />
      </div>
    </div>

    <div class="meta">
      <p>ğŸ‘¥ <strong>Ã‰quipe :</strong> {{ note.equipe }}</p>
      <p>âœï¸ <strong>Auteur :</strong> {{ note.auteur?.nom }}</p>
      <p class="created">ğŸ“… <strong>CrÃ©Ã©e le :</strong> {{ note.created_at | date:'short' }}</p>
      <p *ngIf="note.updated_at" class="updated">âœï¸ <strong>ModifiÃ©e le :</strong> {{ note.updated_at | date:'short' }}</p>
    </div>

    <div class="actions" *ngIf="canEditOrDelete(note)">
      <button (click)="isEditing = true" class="edit-btn">âœï¸ Ã‰diter</button>
      <button (click)="deleteNote()" class="delete-btn">ğŸ—‘ï¸ Supprimer</button>
    </div>
  </div>

  <!-- Mode Ã©dition -->
  <div *ngIf="isEditing" class="edit-mode">
    <input [(ngModel)]="note.titre" placeholder="Titre" class="edit-input" />
    <textarea [(ngModel)]="note.contenu" placeholder="Contenu" class="edit-textarea"></textarea>

    <div class="actions">
      <button (click)="updateNote()" class="save-btn">ğŸ’¾ Sauvegarder</button>
      <button (click)="isEditing = false" class="cancel-btn">âŒ Annuler</button>
    </div>
  </div>

  <hr>
  <app-commentaires [noteId]="note.id"></app-commentaires>
</div>
