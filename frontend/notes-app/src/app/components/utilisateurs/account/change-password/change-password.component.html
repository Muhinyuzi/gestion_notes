<div class="change-password-container" [class.done]="isDone">
  <!-- ğŸ§­ Titre dynamique -->
  <h2 *ngIf="!isDone">
    {{ adminMode && userId
      ? 'ğŸ” Changer le mot de passe de lâ€™utilisateur'
      : 'ğŸ”‘ Changer mon mot de passe' }}
  </h2>

  <!-- âœ… Message de succÃ¨s -->
  <div class="success-message" *ngIf="isDone">
    <h3>âœ… Mot de passe modifiÃ© avec succÃ¨s</h3>
    <p>
      {{
        adminMode && userId
          ? 'Le mot de passe de cet utilisateur a bien Ã©tÃ© mis Ã  jour.'
          : 'Vous allez Ãªtre dÃ©connectÃ© dans quelques secondes. Veuillez vous reconnecter avec votre nouveau mot de passe.'
      }}
    </p>
  </div>

  <!-- ğŸ§¾ Formulaire -->
  <form *ngIf="!isDone" (ngSubmit)="changePassword()" class="password-form">
    <!-- Ancien mot de passe -->
    <div *ngIf="!adminMode || (adminMode && !userId)">
      <label for="oldPassword">Ancien mot de passe</label>
      <div class="input-wrapper">
        <input
          id="oldPassword"
          [type]="showOld ? 'text' : 'password'"
          [(ngModel)]="oldPassword"
          name="oldPassword"
          placeholder="Ancien mot de passe"
          required
          autocomplete="current-password"
        />
        <button
          type="button"
          class="eye-btn"
          aria-label="Afficher ou masquer l'ancien mot de passe"
          (click)="toggleVisibility('old')"
        >
          {{ showOld ? 'ğŸ‘ï¸â€ğŸ—¨ï¸' : 'ğŸ™ˆ' }}
        </button>
      </div>
    </div>

    <!-- Nouveau mot de passe -->
    <label for="newPassword">Nouveau mot de passe</label>
    <div class="input-wrapper">
      <input
        id="newPassword"
        [type]="showNew ? 'text' : 'password'"
        [(ngModel)]="newPassword"
        name="newPassword"
        (input)="checkPasswordStrength()"
        placeholder="Nouveau mot de passe"
        minlength="8"
        required
        autocomplete="new-password"
      />
      <button
        type="button"
        class="eye-btn"
        aria-label="Afficher ou masquer le nouveau mot de passe"
        (click)="toggleVisibility('new')"
      >
        {{ showNew ? 'ğŸ‘ï¸â€ğŸ—¨ï¸' : 'ğŸ™ˆ' }}
      </button>
    </div>

    <!-- ğŸ”¥ Indicateur de force -->
    <div class="password-strength" *ngIf="newPassword">
      <div class="bar" [ngClass]="strengthClass"></div>
      <p [ngClass]="strengthClass">
        Force du mot de passe : <strong>{{ strengthLabel }}</strong>
      </p>
    </div>

    <!-- Confirmation -->
    <label for="confirmPassword">Confirmer le mot de passe</label>
    <div class="input-wrapper">
      <input
        id="confirmPassword"
        [type]="showConfirm ? 'text' : 'password'"
        [(ngModel)]="confirmPassword"
        name="confirmPassword"
        placeholder="Confirmer le mot de passe"
        required
        autocomplete="new-password"
      />
      <button
        type="button"
        class="eye-btn"
        aria-label="Afficher ou masquer la confirmation du mot de passe"
        (click)="toggleVisibility('confirm')"
      >
        {{ showConfirm ? 'ğŸ‘ï¸â€ğŸ—¨ï¸' : 'ğŸ™ˆ' }}
      </button>
    </div>

    <!-- âš™ï¸ Actions -->
    <div class="form-actions">
      <button type="submit" [disabled]="isLoading">
        {{
          isLoading
            ? 'â³ En cours...'
            : adminMode && userId
              ? 'ğŸ’¾ Mettre Ã  jour'
              : 'Changer le mot de passe'
        }}
      </button>

      <!-- âŒ Fermer (admin uniquement) -->
      <button
        *ngIf="adminMode && userId"
        type="button"
        class="cancel-btn"
        (click)="closeDialog()"
      >
        âŒ Fermer
      </button>
    </div>
  </form>
</div>
